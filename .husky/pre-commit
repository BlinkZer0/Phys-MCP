#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# TypeScript linting and type checking
echo "ğŸ“ Linting TypeScript..."
pnpm lint
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript linting failed"
  exit 1
fi

echo "ğŸ” Type checking TypeScript..."
pnpm typecheck
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type checking failed"
  exit 1
fi

# Python linting and type checking
echo "ğŸ Checking Python code..."
cd packages/python-worker

if [ -f "requirements.txt" ]; then
  # Check if ruff is available
  if command -v ruff >/dev/null 2>&1; then
    echo "ğŸ“ Linting Python with ruff..."
    ruff check src/
    if [ $? -ne 0 ]; then
      echo "âŒ Python linting failed"
      exit 1
    fi
  fi

  # Check if mypy is available
  if command -v mypy >/dev/null 2>&1; then
    echo "ğŸ” Type checking Python with mypy..."
    mypy src/ --ignore-missing-imports
    if [ $? -ne 0 ]; then
      echo "âŒ Python type checking failed"
      exit 1
    fi
  fi
fi

cd ../..

echo "âœ… All pre-commit checks passed!"
